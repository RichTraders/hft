[strategy]
algorithm = maker
allow_simultaneous_positions = false

# =========================================
# 벽 탐지 범위
# =========================================
[wall_detection]
# 벽 탐지 최대 거리 (0.15% = BTC $87.5k 기준 약 $131)
max_distance_pct = 0.0015

# 탐색할 최대 호가 레벨 수
max_levels = 100

# =========================================
# 벽 방어 (동적 임계값)
# =========================================
[wall_defense]
# 거래량 기반 컴포넌트 (거래량 EMA)
# Alpha: 0.02 ≈ ~50개 거래 메모리, 0.05 ≈ ~20개 거래 메모리
volume_ema_alpha = 0.03
volume_multiplier = 4.0
volume_min_samples = 20

# 호가창 기반 컴포넌트 (상위 레벨 분석)
orderbook_top_levels = 20
orderbook_multiplier = 3.0
orderbook_percentile = 80

# 하이브리드 가중치 (합계 1.0)
volume_weight = 0.7
orderbook_weight = 0.3

# 최소 벽 수량 (BTC) - 가격에 따라 자동 스케일링
# 예시: 50 BTC × $87.5k = $4.375M, 50 BTC × $100k = $5M
# 안전을 위해 높게 시작, 너무 보수적이면 낮춤
min_quantity = 50.0

# 방어 검증
# 남은 수량 >= 거래 수량 × 배수
qty_multiplier = 2.0

# =========================================
# Robust Z-score (변동성 적응형)
# =========================================
[robust_zscore]
# 윈도우 크기: 중앙값/MAD 계산을 위한 최근 N틱
window_size = 30

# Z-score 계산 전 필요한 최소 샘플 수
min_samples = 20

# 진입 임계값: ±2.5σ (과매도/과매수 감지)
# Robust Z-score는 평균+표준편차 대신 중앙값+MAD 사용
# 이는 팻테일 분포와 이상치에 강함
entry_threshold = 2.5

# =========================================
# 트렌드 가속 필터 (안전장치)
# =========================================
[trend_filter]
# 강한 트렌드 중 진입 차단
enabled = true

# 분석할 최근 틱 수
lookback_ticks = 5

# 최소 연속 동일 방향 틱 (4/5 = 80%)
consecutive_threshold = 4

# 거래량 가속 배수 (최근 vs 이전)
# 최근 2틱 평균 거래량 > 이전 3틱 평균 × 1.5면 가속으로 판단
volume_multiplier = 1.5

# =========================================
# 진입 조건
# =========================================
[entry]
# OBI (호가창 불균형) 임계값: ±0.25 = 25% 우세
obi_threshold = 0.25

# OBI 계산 깊이 (상위 N 레벨)
obi_levels = 5

# 포지션 크기 (BTC)
position_size = 0.01

# 메이커 오더 오프셋 (0.5틱)
safety_margin = 0.00005

# 최소 스프레드 필터 (0.04% = 4bps, 왕복 수수료 커버)
# 바이낸스 VIP0: 메이커 0.02% + 테이커 0.05% = ~0.04% 최소 필요
min_spread_filter = 0.0004

# =========================================
# 청산 전략 (손절)
# =========================================
[exit]
# 벽 수량 감소 임계값 (벽이 50% 이하로 떨어지면 청산)
wall_amount_decay_ratio = 0.5

# 벽 거리 확장 임계값 (벽이 1.2배 더 멀어지면 청산)
wall_distance_expand_ratio = 1.2

# 최대 손실 비율 (0.2%)
max_loss_pct = 0.002

# =========================================
# 디버깅 & 로깅
# =========================================
[debug]
log_wall_detection = true
log_defense_check = true
log_entry_exit = true
