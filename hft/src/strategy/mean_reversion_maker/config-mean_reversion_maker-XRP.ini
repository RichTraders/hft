[strategy]
algorithm = maker
allow_simultaneous_positions = false

# ==========================================
# 심볼: XRPUSDC (바이낸스 USDC 선물)
# 타겟: Low Liquidity + High Accuracy (0.15 OBI)
# ==========================================

[wall_detection]
# 호가가 얇으므로 탐색 범위를 조금 넓게 설정 (0.3%)
max_distance_pct = 0.0030
max_levels = 100

[wall_defense]
threshold_mode = hybrid

# --- 거래량/호가 기준 (USDC 유동성 고려) ---
# 유동성이 적으므로 3배만 튀어도 벽으로 인정
volume_ema_alpha = 0.05
volume_multiplier = 3.0
volume_min_samples = 20

orderbook_top_levels = 20
orderbook_multiplier = 3.0
orderbook_percentile = 85

# 가중치
volume_weight = 0.7
orderbook_weight = 0.3

# --- 최소 벽 수량 (USDC 기준) ---
# 분당 거래량(2.7만)의 약 절반 수준
min_quantity = 15000.0

# 방어 계수
qty_multiplier = 2.0

[robust_zscore]
window_size = 30
min_samples = 20
entry_threshold = 2.0
min_mad_threshold = 0.0001

[trend_filter]
enabled = true
# 추세 가속 감지 윈도우 (reversal_momentum보다 짧게)
lookback_ticks = 10
# 최소 연속 동일 방향 틱 (10틱 중 6틱 = 60%)
consecutive_threshold = 6
# 거래량 가속 배수 (최근 vs 이전)
volume_multiplier = 2.0

[reversal_momentum]
# 반전 모멘텀 확인 (매수 줄고 매도 앞서는 순간 감지)
enabled = true
# 최근 N틱 분석
lookback_ticks = 20
# 최소 동일 방향 틱 수 (20틱 중 10틱 = 50%)
min_directional_ticks = 10
# 거래량 비율 (매도량 / 매수량, 1.3 = 30% 더 많음)
min_volume_ratio = 1.3

[entry]
# [작성자님 피드백 반영]
# 0.45는 속임수가 많음 -> 0.15로 '확실한 반등'만 타격
# 매도세가 진정되고 호가가 균형(-0.15)을 찾을 때 진입
obi_threshold = 0.4
# OBI 계산 깊이 - wall_defense(20)와 동일, 스푸핑 방지
obi_levels = 20

# 포지션 사이즈 (테스트)
position_size = 3.0
safety_margin = 0.0001
min_spread_filter = 0.0

[exit]
# 시간 기반 청산 사용 여부
enabled = false

# === 능동적 청산 (Active Exit - Profit Taking) ===
# Z-score 회귀 청산 (진입: -2.0 → 청산: -0.5)
zscore_exit_threshold = 0.5

# OBI 반전 청산 (XRP는 더 엄격하게 40%)
obi_exit_threshold = 0.7

# 거래량 반전 청산
reversal_momentum_exit = true
exit_lookback_ticks = 10
exit_min_directional_ticks = 7   # 70%
exit_min_volume_ratio = 1.5      # 1.5배

# === 수동적 청산 (Passive Exit - Safety Net) ===
# 얇은 호가창 특성상 벽 기준 완화
wall_amount_decay_ratio = 0.6    # 60% (BTC는 50%)
wall_distance_expand_ratio = 2.5 # 2.5배 (BTC는 1.2배)
max_loss_pct = 0.0015            # 0.15% (BTC는 0.2%)
max_hold_time_sec = 5.0

[debug]
log_wall_detection = true
log_defense_check = true
log_entry_exit = true