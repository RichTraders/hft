[strategy]
algorithm = maker
allow_simultaneous_positions = false

# =========================================
# 벽 탐지 범위
# =========================================
[wall_detection]
# 벽 탐지 최대 거리 (0.15% = BTC $87.5k 기준 약 $131)
max_distance_pct = 0.0015

# 탐색할 최대 호가 레벨 수
max_levels = 100

# =========================================
# 벽 방어 (동적 임계값)
# =========================================
[wall_defense]
# 거래량 기반 컴포넌트 (거래량 EMA)
# Alpha: 0.02 ≈ ~50개 거래 메모리, 0.05 ≈ ~20개 거래 메모리
volume_ema_alpha = 0.03
volume_multiplier = 4.0
volume_min_samples = 10

# 호가창 기반 컴포넌트 (상위 레벨 분석)
orderbook_top_levels = 20
orderbook_multiplier = 3.0
orderbook_percentile = 80

# 하이브리드 가중치 (합계 1.0)
volume_weight = 0.7
orderbook_weight = 0.3

# 최소 벽 수량 (BTC) - 가격에 따라 자동 스케일링
# 예시: 10 BTC × $87.5k = $875k, 10 BTC × $100k = $1M
# 실제 시장에서 관찰되는 벽 크기에 맞춤
min_quantity = 10.0

# 방어 검증
# 남은 수량 >= 거래 수량 × 배수
qty_multiplier = 2.0

# =========================================
# Robust Z-score (변동성 적응형)
# =========================================
[robust_zscore]
# 윈도우 크기: 중앙값/MAD 계산을 위한 최근 N틱
window_size = 30

# Z-score 계산 전 필요한 최소 샘플 수
min_samples = 10

# 진입 임계값: ±2.0σ (과매도/과매수 감지)
# Robust Z-score는 평균+표준편차 대신 중앙값+MAD 사용
# 이는 팻테일 분포와 이상치에 강함
entry_threshold = 2.0

# 최소 MAD 임계값: 횡보장에서 극단적 Z-score 방지
# BTC $88k 기준 5.0 = 약 $7.4 std dev (0.0084%)
# 너무 작은 MAD로 인한 거짓 신호 차단
min_mad_threshold = 5.0

# === 변동성 적응형 임계값 (Volatility-Adaptive Thresholds) ===
# 기준선 MAD 계산 윈도우 (최근 N개 MAD 값의 평균)
baseline_window = 100

# 최소 변동성 스케일러 (저변동성 시장)
# vol_ratio < 0.5일 때: 낮은 임계값으로 작은 움직임도 포착
min_vol_scalar = 0.7

# 최대 변동성 스케일러 (고변동성 시장)
# vol_ratio > 2.0일 때: 높은 임계값으로 노이즈 회피
max_vol_scalar = 1.3

# =========================================
# 평균회귀 추세 추적 (Mean Reversion Tracking)
# =========================================
[mean_reversion]
# 반전 감지를 위한 최소 반등 폭
# 최소값에서 이만큼 회복해야 반전으로 인정
min_reversal_bounce = 0.2

# 중립 영역 복귀 임계값
# 이 값 이상/이하로 돌아가면 추세 리셋
neutral_zone_threshold = 1.0

# === 5-State Phase Tracking (상대적 임계값) ===
# NEUTRAL → BUILDING_OVERSOLD 진입
# |z| > neutral_zone_threshold * building_multiplier
building_multiplier = 1.0

# BUILDING_OVERSOLD → DEEP_OVERSOLD 진입
# |z| > adaptive_threshold * deep_multiplier
deep_multiplier = 1.2

# DEEP_OVERSOLD → REVERSAL_WEAK 진입
# |z| < adaptive_threshold * reversal_weak_multiplier (반등 후)
reversal_weak_multiplier = 0.8

# REVERSAL_WEAK → REVERSAL_STRONG 진입 (진입 가능 상태)
# |z| < adaptive_threshold * reversal_strong_multiplier
reversal_strong_multiplier = 0.6

# =========================================
# 진입 조건
# =========================================
[entry]
# OBI (호가창 불균형) 임계값: ±0.25 = 25% 우세
obi_threshold = 0.25

# OBI 계산 깊이 (상위 N 레벨) - wall_defense와 동일하게 설정
obi_levels = 20

# 포지션 크기 (BTC)
position_size = 0.001

# 메이커 오더 오프셋 (0.5틱)
safety_margin = 0.3

# SHORT 진입 시 Z-score 최소 유지 비율
short_zscore_min_ratio = 0.8

# =========================================
# 시장 체제 탐지 (Market Regime Detection)
# =========================================
[market_regime]
# 고변동성 판단 임계값
high_vol_threshold = 2.0

# 추세 판단 Z-score 임계값
trend_threshold = 1.5

# 추세 판단을 위한 연속 Z-score 개수
trend_history_size = 3

# =========================================
# 청산 전략
# =========================================
[exit]
# === Active Exit Thresholds ===
# Z-score 회귀 청산 (진입: -2.0 → 청산: -0.5)
zscore_exit_threshold = 0.5

# OBI 반전 청산 (0.3 → 0.35로 갭 축소)
obi_exit_threshold = 0.35  # 진입 0.25와 갭 0.1

# === Passive Exit (Safety Net) ===
# 벽 수량 감소 임계값 (50% → 60%)
wall_amount_decay_ratio = 0.6

# 벽 거리 확장 임계값 (1.2배 → 1.5배)
wall_distance_expand_ratio = 1.5

# 최대 손실 비율 (0.2%)
max_loss_pct = 0.002

# 시간 제한 (30초)
max_hold_time_sec = 30.0

# === Multi-Factor Exit Scoring ===
# 최소 복합 청산 점수 (0.65 = MEDIUM urgency)
min_exit_quality = 0.65

# Component weights (합계 = 1.0)
z_reversion_weight = 0.40   # 40% (가장 중요)
obi_reversal_weight = 0.30  # 30%
wall_decay_weight = 0.20    # 20%
time_weight = 0.10          # 10%

# Soft time limit ratio (50% of max_hold_time)
soft_time_ratio = 0.5

# Override mode: lower exit threshold for risky entries
override_exit_threshold = 0.5

# Urgency classification thresholds
urgency_high_threshold = 0.8
urgency_low_threshold = 0.5

# =========================================
# 디버깅 & 로깅
# =========================================
[debug]
log_wall_detection = true
log_defense_check = true
log_entry_exit = true
